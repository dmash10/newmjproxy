"use strict";(self.webpackChunkmidjourney_proxy_admin=self.webpackChunkmidjourney_proxy_admin||[]).push([[185],{77069:function(J,A,i){i.r(A),i.d(A,{default:function(){return Ce}});var E=i(5574),O=i.n(E),ae=i(66927),P=i(90930),X=i(94272),q=i(9361),ne=i(74330),R=i(40056),Z=i(4393),se=i(71230),$=i(15746),m=i(67294),re=i(56790),_=i(75164),oe=i(96159),ie=i(93967),le=i.n(ie),ce=i(64217),de=i(53124),ue=i(48054),me=n=>{const{value:a,formatter:c,precision:t,decimalSeparator:l,groupSeparator:f="",prefixCls:p}=n;let d;if(typeof c=="function")d=c(a);else{const r=String(a),g=r.match(/^(-?)(\d*)(\.(\d+))?$/);if(!g||r==="-")d=r;else{const S=g[1];let o=g[2]||"0",y=g[4]||"";o=o.replace(/\B(?=(\d{3})+(?!\d))/g,f),typeof t=="number"&&(y=y.padEnd(t,"0").slice(0,t>0?t:0)),y&&(y=`${l}${y}`),d=[m.createElement("span",{key:"int",className:`${p}-content-value-int`},S,o),y&&m.createElement("span",{key:"decimal",className:`${p}-content-value-decimal`},y)]}}return m.createElement("span",{className:`${p}-content-value`},d)},ge=i(14747),fe=i(83559),pe=i(83262);const ye=n=>{const{componentCls:a,marginXXS:c,padding:t,colorTextDescription:l,titleFontSize:f,colorTextHeading:p,contentFontSize:d,fontFamily:r}=n;return{[a]:Object.assign(Object.assign({},(0,ge.Wf)(n)),{[`${a}-title`]:{marginBottom:c,color:l,fontSize:f},[`${a}-skeleton`]:{paddingTop:t},[`${a}-content`]:{color:p,fontSize:d,fontFamily:r,[`${a}-content-value`]:{display:"inline-block",direction:"ltr"},[`${a}-content-prefix, ${a}-content-suffix`]:{display:"inline-block"},[`${a}-content-prefix`]:{marginInlineEnd:c},[`${a}-content-suffix`]:{marginInlineStart:c}}})}},xe=n=>{const{fontSizeHeading3:a,fontSize:c}=n;return{titleFontSize:c,contentFontSize:a}};var ve=(0,fe.I$)("Statistic",n=>{const a=(0,pe.IX)(n,{});return[ye(a)]},xe),he=function(n,a){var c={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&a.indexOf(t)<0&&(c[t]=n[t]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,t=Object.getOwnPropertySymbols(n);l<t.length;l++)a.indexOf(t[l])<0&&Object.prototype.propertyIsEnumerable.call(n,t[l])&&(c[t[l]]=n[t[l]]);return c},k=m.forwardRef((n,a)=>{const{prefixCls:c,className:t,rootClassName:l,style:f,valueStyle:p,value:d=0,title:r,valueRender:g,prefix:S,suffix:o,loading:y=!1,formatter:x,precision:j,decimalSeparator:w=".",groupSeparator:F=",",onMouseEnter:Q,onMouseLeave:L}=n,B=he(n,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:N,direction:V,className:W,style:I}=(0,de.dj)("statistic"),h=N("statistic",c),[v,u,T]=ve(h),M=m.createElement(me,{decimalSeparator:w,groupSeparator:F,prefixCls:h,formatter:x,precision:j,value:d}),Y=le()(h,{[`${h}-rtl`]:V==="rtl"},W,t,l,u,T),H=m.useRef(null);m.useImperativeHandle(a,()=>({nativeElement:H.current}));const G=(0,ce.Z)(B,{aria:!0,data:!0});return v(m.createElement("div",Object.assign({},G,{ref:H,className:Y,style:Object.assign(Object.assign({},I),f),onMouseEnter:Q,onMouseLeave:L}),r&&m.createElement("div",{className:`${h}-title`},r),m.createElement(ue.Z,{paragraph:!1,loading:y,className:`${h}-skeleton`},m.createElement("div",{style:p,className:`${h}-content`},S&&m.createElement("span",{className:`${h}-content-prefix`},S),g?g(M):M,o&&m.createElement("span",{className:`${h}-content-suffix`},o)))))});const Se=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function je(n,a){let c=n;const t=/\[[^\]]*]/g,l=(a.match(t)||[]).map(r=>r.slice(1,-1)),f=a.replace(t,"[]"),p=Se.reduce((r,[g,S])=>{if(r.includes(g)){const o=Math.floor(c/S);return c-=o*S,r.replace(new RegExp(`${g}+`,"g"),y=>{const x=y.length;return o.toString().padStart(x,"0")})}return r},f);let d=0;return p.replace(t,()=>{const r=l[d];return d+=1,r})}function we(n,a,c){const{format:t=""}=a,l=new Date(n).getTime(),f=Date.now(),p=Math.max(c?l-f:f-l,0);return je(p,t)}var Te=function(n,a){var c={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&a.indexOf(t)<0&&(c[t]=n[t]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,t=Object.getOwnPropertySymbols(n);l<t.length;l++)a.indexOf(t[l])<0&&Object.prototype.propertyIsEnumerable.call(n,t[l])&&(c[t[l]]=n[t[l]]);return c};function De(n){return new Date(n).getTime()}var ee=n=>{const{value:a,format:c="HH:mm:ss",onChange:t,onFinish:l,type:f}=n,p=Te(n,["value","format","onChange","onFinish","type"]),d=f==="countdown",[r,g]=m.useState(null),S=(0,re.zX)(()=>{const x=Date.now(),j=De(a);g({});const w=d?j-x:x-j;return t==null||t(w),d&&j<x?(l==null||l(),!1):!0});m.useEffect(()=>{let x;const j=()=>_.Z.cancel(x),w=()=>{x=(0,_.Z)(()=>{S()&&w()})};return w(),j},[a,d]),m.useEffect(()=>{g({})},[]);const o=(x,j)=>r?we(x,Object.assign(Object.assign({},j),{format:c}),d):"-",y=x=>(0,oe.Tm)(x,{title:void 0});return m.createElement(k,Object.assign({},p,{value:a,valueRender:y,formatter:o}))};const be=n=>m.createElement(ee,Object.assign({},n,{type:"countdown"}));var Ae=m.memo(be);k.Timer=ee,k.Countdown=Ae;var z=k,te=i(96074),U=i(2487),Ie=i(66309),e=i(85893),K=function(a){var c=a.title,t=a.href,l=a.index,f=a.desc,p=(0,X.useIntl)(),d=q.Z.useToken,r=d(),g=r.token;return(0,e.jsxs)("div",{style:{backgroundColor:g.colorBgContainer,boxShadow:g.boxShadow,borderRadius:"8px",fontSize:"14px",color:g.colorTextSecondary,lineHeight:"22px",padding:"16px 19px",minWidth:"220px",flex:1},children:[(0,e.jsxs)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:[(0,e.jsx)("div",{style:{width:48,height:48,lineHeight:"22px",backgroundSize:"100%",textAlign:"center",padding:"8px 16px 16px 12px",color:"#FFF",fontWeight:"bold",backgroundImage:"url('https://gw.alipayobjects.com/zos/bmw-prod/daaf8d50-8e6d-4251-905d-676a24ddfa12.svg')"},children:l}),(0,e.jsx)("div",{style:{fontSize:"16px",color:g.colorText,paddingBottom:8},children:c})]}),(0,e.jsx)("div",{style:{fontSize:"14px",color:g.colorTextSecondary,textAlign:"justify",lineHeight:"22px",marginBottom:8},children:f}),(0,e.jsxs)("a",{href:t,target:"_blank",rel:"noreferrer",children:[p.formatMessage({id:"pages.welcome.learnMore",defaultMessage:"Learn More"})," ",">"]})]})},Me=function(){var a,c,t,l=q.Z.useToken(),f=l.token,p=(0,X.useModel)("@@initialState"),d=p.initialState,r=(0,X.useIntl)(),g=(0,m.useState)(null),S=O()(g,2),o=S[0],y=S[1],x=(0,m.useState)([]),j=O()(x,2),w=j[0],F=j[1],Q=(0,m.useState)(!0),L=O()(Q,2),B=L[0],N=L[1],V=(0,m.useState)(null),W=O()(V,2),I=W[0],h=W[1];return(0,m.useEffect)(function(){N(!0),h(null),(0,ae.rw)().then(function(v){var u=[],T=null;if(v&&v.success&&Array.isArray(v.data))u=v.data,T=v.message||null;else{var M=v&&v.message||"Failed to load tasks or tasks data is not an array. Check Railway API status and logs.";console.warn("API call to getIndex (tasks) problem:",M,v),h(M),y({todayDraw:0,yesterdayDraw:0,totalDraw:0,top5:[],tops:{"Data Load Error":0},notify:M,stats:{pending:0,success:0,failed:0}}),F([{ip:"Data Load Error",count:0}]),N(!1);return}var Y=new Date().toDateString(),H=new Date(Date.now()-24*60*60*1e3).toDateString(),G=function(D){var C=D.submitTime||D.createTime;return C?new Date(typeof C=="number"?C:String(C)).toDateString():null},Ee=u.filter(function(s){return G(s)===Y}),Fe=u.filter(function(s){return G(s)===H}),Ne=u.filter(function(s){return s.status==="SUCCESS"&&(s.imageUrl||s.attachments&&s.attachments.length>0&&s.attachments[0].url)}).sort(function(s,D){var C=new Date(s.submitTime||s.createTime||0).getTime(),Re=new Date(D.submitTime||D.createTime||0).getTime();return Re-C}).slice(0,5).map(function(s){return{id:s.id||s.taskId||"N/A",prompt:s.prompt||s.description||"Unknown Prompt",imageUrl:s.imageUrl||(s.attachments&&s.attachments.length>0?s.attachments[0].url:void 0),submitTime:s.submitTime||s.createTime}}),b={};u.length>0?(b["Total Tasks Logged"]=u.length,u.forEach(function(s){var D=String(s.action||"NO_ACTION").toUpperCase();b[D]=(b[D]||0)+1})):b["No Tasks Available"]=0;var Oe={todayDraw:Ee.length,yesterdayDraw:Fe.length,totalDraw:u.length,top5:Ne,tops:b,notify:T,stats:{pending:u.filter(function(s){return s.status==="PENDING"||s.status==="IN_PROGRESS"}).length,success:u.filter(function(s){return s.status==="SUCCESS"}).length,failed:u.filter(function(s){return s.status==="FAILURE"||s.status==="FAILED"||s.status&&!["PENDING","IN_PROGRESS","SUCCESS"].includes(String(s.status).toUpperCase())}).length}};y(Oe);var Pe=Object.keys(b).map(function(s){return{ip:s,count:b[s]}});F(Pe)}).catch(function(v){console.error("Critical error in getIndex promise chain:",v),h("Network or critical error: ".concat(v.message,". Please check Railway API status and console.")),y({todayDraw:0,yesterdayDraw:0,totalDraw:0,top5:[],tops:{"Error Loading Data":0},notify:"Failed to load critical data from Railway. Check API logs and console.",stats:{pending:0,success:0,failed:0}}),F([{ip:"Error Loading Data",count:0}])}).finally(function(){N(!1)})},[]),B?(0,e.jsx)(P._z,{children:(0,e.jsx)("div",{style:{textAlign:"center",padding:"50px"},children:(0,e.jsx)(ne.Z,{size:"large",tip:"Loading Dashboard Data from Railway..."})})}):I&&(!o||typeof o.totalDraw!="number"||!o.tops)?(0,e.jsx)(P._z,{children:(0,e.jsx)(R.Z,{message:"Error Loading Dashboard Data",description:I,type:"error",showIcon:!0})}):!o||!o.tops?(0,e.jsx)(P._z,{children:(0,e.jsx)(R.Z,{message:"Data Currently Unavailable",description:"Could not load dashboard data at this moment. Please try refreshing the page or check Railway API logs.",type:"warning",showIcon:!0})}):(0,e.jsxs)(P._z,{children:[I&&B===!1&&typeof o.totalDraw=="number"&&(0,e.jsx)(R.Z,{message:"Data Loading Issue",description:I,type:"warning",closable:!0,style:{marginBottom:16}}),o.notify&&(0,e.jsx)(R.Z,{description:o.notify,banner:!0,closable:!0,style:{marginBottom:16}}),(0,e.jsx)(Z.Z,{style:{borderRadius:8,marginBottom:16},bodyStyle:{backgroundImage:(d==null||(a=d.settings)===null||a===void 0?void 0:a.navTheme)==="realDark"?"background-image: linear-gradient(75deg, #1A1B1F 0%, #191C1F 100%)":"background-image: linear-gradient(75deg, #FBFDFF 0%, #F5F7FF 100%)"},children:(0,e.jsxs)("div",{style:{backgroundPosition:"100% -30%",backgroundRepeat:"no-repeat",backgroundSize:"274px auto",backgroundImage:"url('https://gw.alipayobjects.com/mdn/rms_a9745b/afts/img/A*BuFmQqsB2iAAAAAAAAAAAAAAARQnAQ')"},children:[(0,e.jsxs)("div",{style:{fontSize:"20px",color:f.colorTextHeading},children:[r.formatMessage({id:"pages.welcome.link",defaultMessage:"Welcome to"})," Midjourney Proxy Admin"]}),(0,e.jsx)("p",{style:{fontSize:"14px",color:f.colorTextSecondary,lineHeight:"22px",marginTop:16,marginBottom:32,width:"65%"},children:r.formatMessage({id:"pages.welcome.description",defaultMessage:"Admin interface for your Midjourney Proxy, connected to your Railway deployment."})}),(0,e.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:[(0,e.jsx)(K,{index:1,href:"https://github.com/dmash10/newmjproxy",title:r.formatMessage({id:"pages.welcome.learn",defaultMessage:"About"})+" Your Railway Proxy",desc:r.formatMessage({id:"pages.welcome.midjourney-proxy",defaultMessage:"This admin UI is connected to your Railway deployment based on dmash10/newmjproxy."})}),(0,e.jsx)(K,{index:2,title:r.formatMessage({id:"pages.welcome.learn",defaultMessage:"About"})+" Admin UI",href:"https://github.com/trueai-org/midjourney-proxy-webui",desc:r.formatMessage({id:"pages.welcome.midjourney-proxy-webui",defaultMessage:"The frontend UI project for managing Midjourney Proxy instances."})}),(0,e.jsx)(K,{index:3,title:r.formatMessage({id:"pages.welcome.learn",defaultMessage:"About"})+" API Docs",href:"".concat((d==null||(c=d.currentUser)===null||c===void 0?void 0:c.imagePrefix)||"https://ash3.up.railway.app","/doc.html"),desc:r.formatMessage({id:"pages.activate.apiDoc",defaultMessage:"Interactive API documentation for your Midjourney proxy service."})})]})]})}),o&&typeof o.totalDraw=="number"&&o.tops&&o.stats&&(0,e.jsxs)(Z.Z,{style:{borderRadius:8,marginTop:16},bodyStyle:{backgroundImage:(d==null||(t=d.settings)===null||t===void 0?void 0:t.navTheme)==="realDark"?"background-image: linear-gradient(75deg, #1A1B1F 0%, #191C1F 100%)":"background-image: linear-gradient(75deg, #FBFDFF 0%, #F5F7FF 100%)"},children:[(0,e.jsxs)(se.Z,{gutter:16,style:{textAlign:"center"},children:[(0,e.jsx)($.Z,{xs:24,sm:12,md:6,children:(0,e.jsx)(z,{title:r.formatMessage({id:"pages.welcome.todayDraw"}),value:o.todayDraw})}),(0,e.jsx)($.Z,{xs:24,sm:12,md:6,children:(0,e.jsx)(z,{title:r.formatMessage({id:"pages.welcome.yesterdayDraw"}),value:o.yesterdayDraw})}),(0,e.jsx)($.Z,{xs:24,sm:12,md:6,children:(0,e.jsx)(z,{title:r.formatMessage({id:"pages.welcome.totalDraw"}),value:o.totalDraw})}),(0,e.jsx)($.Z,{xs:24,sm:12,md:6,children:(0,e.jsx)(z,{title:"Success Rate",value:o.totalDraw>0&&o.stats.success>=0?(o.stats.success/o.totalDraw*100).toFixed(1)+"%":o.totalDraw===0?"N/A":"0%"})})]}),(0,e.jsx)(te.Z,{orientation:"left",children:r.formatMessage({id:"pages.welcome.top5",defaultMessage:"Recent Successful Tasks"})}),o.top5&&o.top5.length>0?(0,e.jsx)(U.Z,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4,xl:5,xxl:5},dataSource:o.top5,renderItem:function(u){var T;return(0,e.jsx)(U.Z.Item,{children:(0,e.jsxs)(Z.Z,{hoverable:!0,cover:u.imageUrl?(0,e.jsx)("img",{alt:(T=u.prompt)===null||T===void 0?void 0:T.substring(0,30),src:u.imageUrl,style:{height:150,objectFit:"cover"}}):(0,e.jsx)("div",{style:{height:150,display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:"No Image"}),children:[(0,e.jsx)(Z.Z.Meta,{title:"ID: ".concat(u.id),description:"".concat((u.prompt||"No prompt").substring(0,60),"...")}),(0,e.jsxs)("small",{children:["Time: ",u.submitTime?new Date(typeof u.submitTime=="number"?u.submitTime:String(u.submitTime)).toLocaleString():"N/A"]})]})})}}):(0,e.jsx)("p",{style:{padding:"20px",textAlign:"center"},children:r.formatMessage({id:"pages.welcome.noSuccessfulTasks",defaultMessage:"No successful tasks with images to display recently."})}),(0,e.jsx)(te.Z,{orientation:"left",children:r.formatMessage({id:"pages.welcome.topStatsBy",defaultMessage:"Task Counts by Category"})}),w&&w.length>0?(0,e.jsx)(U.Z,{dataSource:w,renderItem:function(u){return(0,e.jsxs)(U.Z.Item,{children:[(0,e.jsx)(Ie.Z,{children:u.ip})," ",u.count," ",r.formatMessage({id:"pages.welcome.unit",defaultMessage:"tasks"})]})}}):(0,e.jsx)("p",{style:{padding:"20px",textAlign:"center"},children:r.formatMessage({id:"pages.welcome.noTaskCategories",defaultMessage:"No task categories to display."})})]})]})},Ce=Me},15746:function(J,A,i){var E=i(21584);A.Z=E.Z},71230:function(J,A,i){var E=i(17621);A.Z=E.Z}}]);
